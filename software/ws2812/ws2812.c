/**
 * Copyright (c) 2020 Raspberry Pi (Trading) Ltd.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

#include <stdio.h>
#include <stdlib.h>

#include "pico/stdlib.h"
#include "hardware/pio.h"
#include "hardware/clocks.h"
#include "ws2812.pio.h"
#include "pico/multicore.h"

#define LED_NUM (64)

const int PIN_TX = 1;

static inline void put_pixel(uint32_t pixel_grb) {
    pio_sm_put_blocking(pio0, 0, pixel_grb << 8u);
}

static inline uint32_t urgb_u32(uint8_t r, uint8_t g, uint8_t b) {
    return
            ((uint32_t) (r) << 8) |
            ((uint32_t) (g) << 16) |
            (uint32_t) (b);
}

struct color_rgb888 {
    uint8_t r;
    uint8_t g;
    uint8_t b;
};

struct color_rgb888 color_map[64] = {
        {0x00,0x00,0x00},{0x00,0x20,0x00},{0x00,0x20,0x00},{0x00,0x00,0x00},{0x00,0x00,0x00},{0x00,0x20,0x00},{0x00,0x20,0x00},{0x00,0x00,0x00},

        {0x00,0x00,0x00},{0x00,0x00,0x00},{0x00,0x20,0x00},{0x00,0x20,0x00},{0x00,0x20,0x00},{0x00,0x20,0x00},{0x00,0x00,0x00},{0x00,0x00,0x00},

        {0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},

        {0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},

        {0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},

        {0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},

        {0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},

        {0x00,0x00,0x00},{0x00,0x00,0x00},{0x20,0x00,0x00},{0x20,0x00,0x00},{0x20,0x00,0x00},{0x20,0x00,0x00},{0x00,0x00,0x00},{0x00,0x00,0x00},
};


void ws2812b_core() {
    while (1){
		
		for(int i=0; i<LED_NUM; i++) {
            put_pixel(urgb_u32(color_map[i].r, color_map[i].g, color_map[i].b));

		}
		sleep_us(400);
	}

}	

int main() {
	
    stdio_init_all();
	
	PIO pio = pio0;
    int sm = 0;
    uint offset = pio_add_program(pio, &ws2812_program);
    ws2812_program_init(pio, sm, offset, PIN_TX, 800000, false);
	
 
	multicore_launch_core1(ws2812b_core);
   
    while (1) { }
}
